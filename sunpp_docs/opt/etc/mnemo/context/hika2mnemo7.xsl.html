
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>hika2mnemo7.xsl</title>
    <!--
    <style>
        body { font-family: Arial, sans-serif; }
        pre { background-color: #f0f0f0; padding: 10px; white-space: pre-wrap; word-wrap: break-word; }
    </style>
    -->
    <style>
        body { 
            font-family: Arial, sans-serif; 
        }
        pre { 
            background-color: #f0f0f0; 
            padding: 10px; 
            white-space: pre-wrap; 
            word-wrap: break-word;
            font-size: 14px;  /* Увеличенный размер шрифта */
            line-height: 1.5; /* Улучшенная читаемость */
        }
    </style>
</head>
<body>
    <h1>hika2mnemo7.xsl</h1>
    <pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
  xmlns:str=&quot;http://exslt.org/strings&quot;
  xmlns:math=&quot;http://exslt.org/math&quot;
  xmlns:crypto=&quot;http://exslt.org/crypto&quot;
  extension-element-prefixes=&quot;str math crypto&quot;
  &gt;

&lt;xsl:param name=&quot;bindPrefix&quot;/&gt;
&lt;xsl:param name=&quot;bindNS&quot;/&gt;
&lt;xsl:param name=&quot;mnemoId&quot;/&gt;


&lt;xsl:output method=&quot;text&quot; omit-xml-declaration=&quot;yes&quot; indent=&quot;no&quot; encoding=&quot;UTF-8&quot;/&gt;
&lt;xsl:strip-space elements=&quot;*&quot; /&gt;

&lt;!-- Игнорируем горизонтальные строки за пределами мнемосхемы --&gt;
  &lt;xsl:template match=&quot;line[number(@y1)&amp;lt;=0 and number(@y2)=number(@y1)]&quot;/&gt;
  &lt;xsl:template match=&quot;line[number(@y1)&amp;gt;=number(/fragment/@h) and number(@y2)=number(@y1)]&quot;/&gt;

&lt;xsl:template match=&quot;/&quot;&gt;
&lt;xsl:text&gt;/* This file is automatically generated. Do not make changes. */
import lib.hikalib7 as h;
import s_func7 as sfunc
from colorhika import Styler;

debug ?= False;
aspect ?= 1;
mnemo_marging ?= 0;
max_width ?= 4096;
max_height ?= 2160;
mwidth := min(&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(/fragment/@w)&quot;/&gt;&lt;xsl:text&gt;, max_width);
mheight := min(&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(/fragment/@h)&quot;/&gt;&lt;xsl:text&gt;, max_height);
mnemo_width := aspect * mwidth;
mnemo_height := mheight;

pg := h.HikaBinder(namespace=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$bindNS&quot;/&gt;&lt;xsl:text&gt;&#x27;, mnemoid=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$mnemoId&quot;/&gt;&lt;xsl:text&gt;&#x27;, pgsource=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$xmlSrc&quot;/&gt;&lt;xsl:text&gt;&#x27;);
styler := Styler();

&lt;/xsl:text&gt;
        &lt;xsl:apply-templates select=&quot;/fragment&quot;/&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;fragment&quot;&gt; &lt;!--  --&gt;
&lt;xsl:text&gt;
Mnemo(
  x=-mnemo_marging, y=-mnemo_marging, width=mnemo_width+2*mnemo_marging, height=mnemo_height+2*mnemo_marging,
  class=&#x27;mnemo hika&#x27;, title=pg.title(), stylesheets = &#x27;../dark.css&#x27;
){&amp;#xa;&lt;/xsl:text&gt;
&lt;xsl:text&gt; tmp := styler.set_background_color(&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;static/@bgcolor&quot; /&gt;&lt;xsl:text&gt;&quot;);&amp;#xa;&lt;/xsl:text&gt;
  &lt;!-- FIXME: BACKGROUND RECT FOR TESTING PURPOSES --&gt;
  &lt;xsl:text&gt; if (not(styler.background_color_is_transparent)) {&amp;#xa;&lt;/xsl:text&gt;
  &lt;xsl:text&gt;  rect(-mnemo_marging, -mnemo_marging, mnemo_width+2*mnemo_marging, mnemo_height+2*mnemo_marging, class=&quot;Solid&quot;, attributes=styler.styling(bc=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;static/@bgcolor&quot; /&gt;&lt;xsl:text&gt;&quot;));&amp;#xa;&lt;/xsl:text&gt;
  &lt;xsl:text&gt; }&amp;#xa;&lt;/xsl:text&gt;
  &lt;xsl:apply-templates select=&quot;static&quot;/&gt;
  &lt;xsl:apply-templates select=&quot;dynamic&quot;/&gt;
&lt;!--  &lt;xsl:apply-templates select=&quot;static|dynamic&quot;/&gt; --&gt;
&lt;xsl:text&gt;}  // Mnemo&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;static&quot;&gt;
 &lt;xsl:if test=&quot;./*&quot;&gt;
 group(class=&#x27;mnemo-static&#x27;){
&lt;xsl:apply-templates select=&quot;./*&quot;/&gt; }  // static group
 &lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;dynamic&quot;&gt;
 &lt;xsl:if test=&quot;./*&quot;&gt;
 group(class=&#x27;mnemo-dynamic&#x27;){
&lt;xsl:apply-templates select=&quot;./*&quot;/&gt; }  // dynamic group
&lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;!-- &lt;xsl:template match=&quot;line[@ps=&#x27;solid&#x27;]&quot;&gt; --&gt;

&lt;xsl:template match=&quot;colors&quot;&gt;
    &lt;xsl:if test=&quot;./@*&quot;&gt;
        &lt;xsl:text&gt;, colors=(&lt;/xsl:text&gt;
            &lt;xsl:for-each select=&quot;./@*&quot;&gt;
                &lt;xsl:value-of select=&quot;local-name(.)&quot;/&gt;
                &lt;xsl:text&gt;=&#x27;&lt;/xsl:text&gt;
                &lt;xsl:value-of select=&quot;.&quot;/&gt;
                &lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
                &lt;xsl:if test=&quot;position() != last()&quot;&gt;
                  &lt;xsl:text&gt;, &lt;/xsl:text&gt;
                &lt;/xsl:if&gt;
            &lt;/xsl:for-each&gt;
        &lt;xsl:text&gt;)&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;line&quot;&gt;
&lt;xsl:text&gt;  line(Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@x1)&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@y1)&quot;/&gt;
    &lt;xsl:text&gt;), Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@x2)&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@y2)&quot;/&gt;&lt;xsl:text&gt;)&lt;/xsl:text&gt;
    &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;rect&quot;&gt;
&lt;xsl:text&gt;  rect(topleft=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@x)&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@y)&quot;/&gt;
    &lt;xsl:text&gt;), width=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@w|@width)&quot;/&gt;
    &lt;xsl:text&gt;, height=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@h|@height)&quot;/&gt;
    &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;text&quot;&gt;
  &lt;xsl:if test=&quot;@x&quot;&gt;
&lt;xsl:text&gt;  text(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@x)&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@y)&quot;/&gt;
    &lt;xsl:text&gt;, &quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;str:replace(str:replace(./img/@text, &#x27;\&#x27;, &#x27;\\&#x27;), &#x27;&amp;quot;&#x27;, &#x27;\&amp;quot;&#x27;)&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;xsl:with-param name=&quot;func&quot;&gt;text_styling&lt;/xsl:with-param&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;symbol&quot;&gt;
    &lt;xsl:if test=&quot;@x&quot;&gt;
    &lt;xsl:text&gt;  h.symbol(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
    &lt;xsl:text&gt;), value=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(.//*/@cod)&quot;/&gt;
    &lt;xsl:text&gt;, font_size=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.//*/@size&quot;/&gt;
    &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;xsl:with-param name=&quot;func&quot;&gt;text_styling&lt;/xsl:with-param&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;sblock&quot;&gt;
    &lt;xsl:text&gt;  h.&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@name&quot;/&gt;
    &lt;xsl:text&gt;(Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@x)&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@y)&quot;/&gt;
    &lt;xsl:text&gt;)&lt;/xsl:text&gt;
    &lt;xsl:if test=&quot;@mirror&quot;&gt;
        &lt;xsl:text&gt;, mirror=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@mirror&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;@conner&quot;&gt;
        &lt;xsl:text&gt;, conner=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@conner)&quot;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);&amp;#xa;&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;spict&quot;&gt;
    &lt;xsl:variable name=&quot;x&quot; select=&quot;number(@x)&quot;/&gt;
    &lt;xsl:variable name=&quot;y&quot; select=&quot;number(@y)&quot;/&gt;
    &lt;xsl:variable name=&quot;height&quot; select=&quot;number(@h|@height)&quot;/&gt;
    &lt;xsl:variable name=&quot;width&quot; select=&quot;number(@w|@width)&quot;/&gt;
    &lt;xsl:variable name=&quot;name&quot; select=&quot;substring-before(@name, &#x27;.&#x27;)&quot;/&gt;
    &lt;xsl:variable name=&quot;ext&quot; select=&quot;substring-after(@name, &#x27;.&#x27;)&quot;/&gt;
    &lt;xsl:variable name=&quot;href&quot; select=&quot;concat(crypto:md5($name), &#x27;.&#x27;, $ext)&quot;/&gt;

    &lt;xsl:text&gt;  image(x=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$x&quot;/&gt;
        &lt;xsl:text&gt;, y=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$y&quot;/&gt;
        &lt;xsl:text&gt;, height=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$height&quot;/&gt;
        &lt;xsl:text&gt;, width=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$width&quot;/&gt;
        &lt;xsl:text&gt;, href=&quot;img/&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$href&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
        &lt;xsl:text&gt;, name=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$name&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
        &lt;xsl:text&gt;, preserveAspectRatio=&quot;none&quot;&lt;/xsl:text&gt;
        &lt;xsl:text&gt;);
    &lt;/xsl:text&gt;

&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;ellipse[@type]|arc&quot;&gt;
    &lt;xsl:variable name=&quot;rx&quot; select=&quot;number(@w|@width) div 2&quot;/&gt;
    &lt;xsl:variable name=&quot;ry&quot; select=&quot;number(@h|@height) div 2&quot;/&gt;
    &lt;xsl:variable name=&quot;cx&quot; select=&quot;number(@x) + $rx&quot;/&gt;
    &lt;xsl:variable name=&quot;cy&quot; select=&quot;number(@y) + $ry&quot;/&gt;
    &lt;xsl:variable name=&quot;a1&quot;&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test=&quot;@a&quot;&gt;-&lt;xsl:value-of select=&quot;@a&quot;/&gt;&lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;0&lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:variable&gt;
    &lt;xsl:if test=&quot;@alen and $rx &amp;gt; 0 and $ry &amp;gt; 0&quot;&gt;&lt;xsl:if test=&quot;number(@alen) != 0&quot;&gt;
        &lt;xsl:variable name=&quot;a2&quot; select=&quot;number($a1)-number(@alen)&quot;/&gt;
        &lt;xsl:text&gt;  &lt;/xsl:text&gt;
        &lt;xsl:if test=&quot;@type&quot;&gt;&lt;xsl:value-of select=&quot;@type&quot;/&gt;&lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;not(@type)&quot;&gt;&lt;xsl:text&gt;arc&lt;/xsl:text&gt;&lt;/xsl:if&gt;
        &lt;xsl:text&gt;(c=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$cx&quot;/&gt;
        &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$cy&quot;/&gt;
        &lt;xsl:choose&gt;
          &lt;xsl:when test=&quot;number(@w)=number(@h)&quot;&gt;
            &lt;xsl:text&gt;), radius=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$rx&quot;/&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt;
            &lt;xsl:text&gt;), rx=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$rx&quot;/&gt;
            &lt;xsl:text&gt;, ry=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$ry&quot;/&gt;
          &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;
         &lt;xsl:text&gt;, angles=(&lt;/xsl:text&gt;
         &lt;xsl:choose&gt;
            &lt;xsl:when test=&quot;number(@alen) &amp;gt; 0&quot;&gt;
                &lt;xsl:value-of select=&quot;$a2&quot;/&gt;&lt;xsl:text&gt;, &lt;/xsl:text&gt;
                &lt;xsl:value-of select=&quot;$a1&quot;/&gt;
            &lt;/xsl:when&gt;
            &lt;xsl:otherwise&gt;
                &lt;xsl:value-of select=&quot;$a1&quot;/&gt;&lt;xsl:text&gt;, &lt;/xsl:text&gt;
                &lt;xsl:value-of select=&quot;$a2&quot;/&gt;
            &lt;/xsl:otherwise&gt;
          &lt;/xsl:choose&gt;
        &lt;xsl:text&gt;)&lt;/xsl:text&gt;
        &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
        &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
   &lt;/xsl:if&gt;&lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;ellipse[@type=&#x27;circle&#x27;]&quot;&gt;
    &lt;xsl:variable name=&quot;rx&quot; select=&quot;number(@w|@width) div 2&quot;/&gt;
    &lt;xsl:variable name=&quot;ry&quot; select=&quot;number(@h|@height) div 2&quot;/&gt;
    &lt;xsl:variable name=&quot;cx&quot; select=&quot;number(@x) + $rx&quot;/&gt;
    &lt;xsl:variable name=&quot;cy&quot; select=&quot;number(@y) + $ry&quot;/&gt;
    &lt;xsl:variable name=&quot;r&quot; select=&quot;($rx + $ry) div 2&quot;/&gt;

    &lt;xsl:text&gt;  circle(c=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$cx&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$cy&quot;/&gt;
    &lt;xsl:text&gt;), r=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$r&quot;/&gt;
    &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;ellipse|ellipse[@type=&#x27;ellipse&#x27;]&quot;&gt;
&lt;xsl:variable name=&quot;rx&quot; select=&quot;number(@w|@width) div 2&quot;/&gt;
&lt;xsl:variable name=&quot;ry&quot; select=&quot;number(@h|@height) div 2&quot;/&gt;
&lt;xsl:variable name=&quot;cx&quot; select=&quot;number(@x) + $rx&quot;/&gt;
&lt;xsl:variable name=&quot;cy&quot; select=&quot;number(@y) + $ry&quot;/&gt;
&lt;xsl:choose&gt;
  &lt;xsl:when test=&quot;$rx=$ry&quot;&gt;
    &lt;xsl:text&gt;  circle(c=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$cx&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$cy&quot;/&gt;
    &lt;xsl:text&gt;), radius=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$rx&quot;/&gt;
  &lt;/xsl:when&gt;
  &lt;xsl:otherwise&gt;
    &lt;xsl:text&gt;  ellipse(c=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$cx&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$cy&quot;/&gt;
    &lt;xsl:text&gt;), rx=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$rx&quot;/&gt;
    &lt;xsl:text&gt;, ry=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$ry&quot;/&gt;
  &lt;/xsl:otherwise&gt;
&lt;/xsl:choose&gt;
    &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;polyline&quot;&gt;
  &lt;xsl:if test=&quot;string(@points) != &#x27;&#x27;&quot;&gt;

    &lt;xsl:text&gt;  polyline(&lt;/xsl:text&gt;
    &lt;xsl:for-each select=&quot;str:tokenize(string(@points), &#x27;[; ]+&#x27;)&quot;&gt;
        &lt;xsl:if test=&quot;position()!=1&quot;&gt;
            &lt;xsl:text&gt;, &lt;/xsl:text&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:text&gt;Point(&lt;/xsl:text&gt;
            &lt;xsl:for-each select=&quot;str:tokenize(string(.), &#x27;,&#x27;)&quot;&gt;
                &lt;xsl:if test=&quot;position()!=1&quot;&gt;&lt;xsl:text&gt;*aspect, &lt;/xsl:text&gt;&lt;/xsl:if&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;
            &lt;/xsl:for-each&gt;
        &lt;xsl:text&gt;)&lt;/xsl:text&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
  &lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;polygon&quot;&gt;
    &lt;xsl:if test=&quot;string(@points) != &#x27;&#x27;&quot;&gt;
    &lt;xsl:text&gt;  polygon(&lt;/xsl:text&gt;
    &lt;xsl:for-each select=&quot;str:tokenize(string(@points), &#x27;[; ]+&#x27;)&quot;&gt;
        &lt;xsl:if test=&quot;position()!=1&quot;&gt;
            &lt;xsl:text&gt;, &lt;/xsl:text&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:text&gt;Point(&lt;/xsl:text&gt;
            &lt;xsl:for-each select=&quot;str:tokenize(string(.), &#x27;,&#x27;)&quot;&gt;
                &lt;xsl:if test=&quot;position()!=1&quot;&gt;&lt;xsl:text&gt;*aspect, &lt;/xsl:text&gt;&lt;/xsl:if&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;
            &lt;/xsl:for-each&gt;
        &lt;xsl:text&gt;)&lt;/xsl:text&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;);
    &lt;/xsl:text&gt;
  &lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;!-- shkala --&gt;
&lt;xsl:template name=&quot;gen-format&quot;&gt;
  &lt;xsl:param name=&quot;forvalue&quot;/&gt;
  &lt;xsl:variable name=&quot;precision&quot; select=&quot;string-length(substring-after($forvalue, &#x27;.&#x27;))&quot;/&gt;
    &lt;xsl:text&gt;&#x27;%&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;string-length($forvalue)&quot;/&gt;
  &lt;xsl:choose&gt;
    &lt;xsl:when test=&quot;$precision=0&quot;&gt;
      &lt;xsl:text&gt;d&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:otherwise&gt;
      &lt;xsl:text&gt;.&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$precision&quot;/&gt;&lt;xsl:text&gt;f&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;shkala[img/@type=&#x27;G&#x27;]&quot;&gt;
    &lt;xsl:variable name=&quot;img&quot; select=&quot;./img&quot;/&gt;
    &lt;xsl:text&gt;  h.shkalaG(x_range=(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@x&quot;/&gt;
    &lt;xsl:text&gt;, aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@x + $img/@length&quot;/&gt;
    &lt;xsl:text&gt;), y=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@y&quot;/&gt;
    &lt;xsl:text&gt;, direction=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@dir&quot;/&gt;
    &lt;xsl:text&gt;&#x27;, v_range=(&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_n&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_v&quot;/&gt;
    &lt;xsl:text&gt;), delen=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@del&quot;/&gt;
    &lt;xsl:text&gt;, krat=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@krat&quot;/&gt;
    &lt;xsl:if test=&quot;not(./img/@vid)&quot;&gt;
        &lt;xsl:text&gt;, labels_format=&lt;/xsl:text&gt;
        &lt;xsl:call-template name=&quot;gen-format&quot;&gt;&lt;xsl:with-param name=&quot;forvalue&quot; select=&quot;string($img/@del)&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/setpoints/@*&quot;&gt;
        &lt;xsl:text&gt;, setpoints=(&lt;/xsl:text&gt;
            &lt;xsl:for-each select=&quot;./img/setpoints/@*&quot;&gt;
                &lt;xsl:value-of select=&quot;local-name(.)&quot;/&gt;
                &lt;xsl:text&gt;=&lt;/xsl:text&gt;
                &lt;xsl:value-of select=&quot;translate(., &#x27;,&#x27;, &#x27;.&#x27;)&quot;/&gt;
                &lt;xsl:text&gt;,&lt;/xsl:text&gt;
            &lt;/xsl:for-each&gt;
        &lt;xsl:text&gt;)&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;

    &lt;xsl:call-template name=&quot;gen-style&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;$img&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;shkala[img/@type=&#x27;V&#x27;]&quot;&gt;
    &lt;xsl:variable name=&quot;img&quot; select=&quot;./img&quot;/&gt;
    &lt;xsl:text&gt;  h.shkalaV(y_range=(&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@y&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@y + $img/@length&quot;/&gt;
    &lt;xsl:text&gt;), x=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@x&quot;/&gt;
    &lt;xsl:text&gt;, direction=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@dir&quot;/&gt;
    &lt;xsl:text&gt;&#x27;, v_range=(&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_n&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_v&quot;/&gt;
    &lt;xsl:text&gt;), delen=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@del&quot;/&gt;
    &lt;xsl:text&gt;, krat=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@krat&quot;/&gt;
    &lt;xsl:if test=&quot;not(./img/@vid)&quot;&gt;
        &lt;xsl:text&gt;, labels_format=&lt;/xsl:text&gt;
        &lt;xsl:call-template name=&quot;gen-format&quot;&gt;&lt;xsl:with-param name=&quot;forvalue&quot; select=&quot;string($img/@del)&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/setpoints/@*&quot;&gt;
        &lt;xsl:text&gt;, setpoints=(&lt;/xsl:text&gt;
            &lt;xsl:for-each select=&quot;./img/setpoints/@*&quot;&gt;
                &lt;xsl:value-of select=&quot;local-name(.)&quot;/&gt;
                &lt;xsl:text&gt;=&lt;/xsl:text&gt;
                &lt;xsl:value-of select=&quot;translate(., &#x27;,&#x27;, &#x27;.&#x27;)&quot;/&gt;
                &lt;xsl:text&gt;,&lt;/xsl:text&gt;
            &lt;/xsl:for-each&gt;
        &lt;xsl:text&gt;)&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:call-template name=&quot;gen-style&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;$img&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;sfunc&quot;&gt;
    &lt;xsl:text&gt;sfunc.&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@func&quot;/&gt;
    &lt;xsl:text&gt;(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
    &lt;xsl:text&gt;), w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
    &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
    &lt;xsl:if test=&quot;@name&quot;&gt;
        &lt;xsl:text&gt;, title=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@name&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;!-- dyn --&gt;
&lt;!-- skip TEP params  --&gt;
&lt;xsl:template match=&quot;dtext[img/@name=&#x27;TEPN&#x27;]&quot; /&gt;
&lt;xsl:template match=&quot;dtext[img/@name=&#x27;TEPND&#x27;]&quot; /&gt;
&lt;xsl:template match=&quot;dtext[img/@name=&#x27;TEPP&#x27;]&quot; /&gt;
&lt;xsl:template match=&quot;dtext[img/@name=&#x27;TEPB&#x27;]&quot; /&gt;

&lt;xsl:template name=&quot;gen-bind&quot;&gt;
  &lt;xsl:param name=&quot;elem&quot;/&gt;
  &lt;xsl:variable name=&quot;params&quot; select=&quot;$elem//param&quot;/&gt;
  &lt;xsl:if test=&quot;$params&quot;&gt;
    &lt;xsl:text&gt;bind=pg.tag(&lt;/xsl:text&gt;
          &lt;xsl:for-each select=&quot;$params&quot;&gt;
            &lt;xsl:apply-templates select=&quot;.&quot;/&gt;
            &lt;xsl:if test=&quot;position() != last()&quot;&gt;
              &lt;xsl:text&gt;, &lt;/xsl:text&gt;
            &lt;/xsl:if&gt;
          &lt;/xsl:for-each&gt;
          &lt;xsl:text&gt;)&lt;/xsl:text&gt;
  &lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;param&quot;&gt;
    &lt;xsl:text&gt;(&#x27;&lt;/xsl:text&gt;
    &lt;xsl:value-of select=&quot;$bindPrefix&quot;/&gt;:&lt;xsl:value-of select=&quot;@mas&quot;/&gt;&lt;xsl:text&gt;&#x27;, &#x27;&lt;/xsl:text&gt;
    &lt;xsl:value-of select=&quot;@nom&quot;/&gt;&lt;xsl:text&gt;&#x27;, &quot;&lt;/xsl:text&gt;
    &lt;xsl:value-of select=&quot;@iden&quot;/&gt;
    &lt;xsl:text&gt;&quot;)&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;xsl:template name=&quot;gen-colors&quot;&gt;
  &lt;xsl:param name=&quot;elem&quot;/&gt;
  &lt;xsl:variable name=&quot;colors&quot; select=&quot;$elem//color&quot;/&gt;
  &lt;xsl:if test=&quot;$colors&quot;&gt;
    &lt;xsl:text&gt;, colors=(&lt;/xsl:text&gt;
          &lt;xsl:for-each select=&quot;$colors&quot;&gt;
            &lt;xsl:apply-templates select=&quot;.&quot;/&gt;
            &lt;xsl:if test=&quot;position() != last()&quot;&gt;
              &lt;xsl:text&gt;, &lt;/xsl:text&gt;
            &lt;/xsl:if&gt;
          &lt;/xsl:for-each&gt;
          &lt;xsl:text&gt;)&lt;/xsl:text&gt;
  &lt;/xsl:if&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;color&quot;&gt;
    &lt;xsl:text&gt;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@cod_ekr&quot;/&gt;
&lt;/xsl:template&gt;


&lt;xsl:template name=&quot;gen-series&quot;&gt;
  &lt;xsl:param name=&quot;elem&quot;/&gt;
  &lt;xsl:variable name=&quot;params&quot; select=&quot;$elem//param&quot;/&gt;
  &lt;xsl:if test=&quot;$params&quot;&gt;
    &lt;xsl:text&gt;, series=(&lt;/xsl:text&gt;
          &lt;xsl:for-each select=&quot;$params&quot;&gt;
            &lt;xsl:text&gt;(&lt;/xsl:text&gt;
            &lt;xsl:text&gt;rang=(&lt;/xsl:text&gt;
              &lt;xsl:choose&gt;
                 &lt;xsl:when test=&quot;./@pred_n_graf&quot;&gt;
                   &lt;xsl:value-of select=&quot;./@pred_n_graf&quot;/&gt;
                 &lt;/xsl:when&gt;
                 &lt;xsl:otherwise&gt;
                   &lt;xsl:text&gt;None&lt;/xsl:text&gt;
                 &lt;/xsl:otherwise&gt;
              &lt;/xsl:choose&gt;
              &lt;xsl:text&gt;, &lt;/xsl:text&gt;
              &lt;xsl:choose&gt;
                 &lt;xsl:when test=&quot;./@pred_v_graf&quot;&gt;
                   &lt;xsl:value-of select=&quot;./@pred_v_graf&quot;/&gt;
                 &lt;/xsl:when&gt;
                 &lt;xsl:otherwise&gt;
                   &lt;xsl:text&gt;None&lt;/xsl:text&gt;
                 &lt;/xsl:otherwise&gt;
              &lt;/xsl:choose&gt;
            &lt;xsl:text&gt;), &lt;/xsl:text&gt;
            &lt;xsl:text&gt;bind=pg.tag(&lt;/xsl:text&gt;
            &lt;xsl:apply-templates select=&quot;.&quot;/&gt;
            &lt;xsl:text&gt;)&lt;/xsl:text&gt;
            &lt;xsl:text&gt;)&lt;/xsl:text&gt;
            &lt;xsl:if test=&quot;position() != last()&quot;&gt;
              &lt;xsl:text&gt;, &lt;/xsl:text&gt;
            &lt;/xsl:if&gt;
          &lt;/xsl:for-each&gt;
          &lt;xsl:text&gt;)&lt;/xsl:text&gt;
  &lt;/xsl:if&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;block&quot;&gt;
&lt;xsl:text&gt;  h.&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@name&quot;/&gt;
    &lt;xsl:text&gt;(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
    &lt;xsl:text&gt;), w=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
    &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;
    &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;, algor=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./params/@algor&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;

    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;dtext&quot;&gt;
    &lt;xsl:text&gt;  h.dtext(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
    &lt;xsl:text&gt;), w=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
    &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
    &lt;xsl:text&gt;, algor=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./params/@algor&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;xsl:if test=&quot;./img/@drawframe&quot;&gt;
       &lt;xsl:text&gt;, drawframe=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@drawframe&quot;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/@din&quot;&gt;
       &lt;xsl:text&gt;, din=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@din&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/@format&quot;&gt;
       &lt;xsl:text&gt;, format=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@format&quot;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/format&quot;&gt;
       &lt;xsl:text&gt;, format_obj=(&lt;/xsl:text&gt;&lt;xsl:apply-templates select=&quot;./img/format&quot;/&gt;&lt;xsl:text&gt;)&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/@name&quot;&gt;
       &lt;xsl:text&gt;, name=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@name&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/@align&quot;&gt;
       &lt;xsl:text&gt;, align=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@align&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;
    &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;./img&quot;/&gt;&lt;xsl:with-param name=&quot;func&quot;&gt;text_styling&lt;/xsl:with-param&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;format&quot;&gt;
    &lt;xsl:for-each select=&quot;./@*&quot;&gt;
        &lt;xsl:value-of select=&quot;local-name(.)&quot;/&gt;
        &lt;xsl:text&gt;=&#x27;&lt;/xsl:text&gt;
        &lt;xsl:value-of select=&quot;.&quot;/&gt;
        &lt;xsl:text&gt;&#x27;,&lt;/xsl:text&gt;
    &lt;/xsl:for-each&gt;
&lt;/xsl:template&gt;


&lt;!-- graph --&gt;

&lt;xsl:template match=&quot;graph&quot;&gt;
    &lt;xsl:text&gt;  h.graph(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
    &lt;xsl:text&gt;), w=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
    &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;

    &lt;xsl:if test=&quot;./img/@time_draw&quot;&gt;
       &lt;xsl:text&gt;, time_draw=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@time_draw&quot;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/@scale&quot;&gt;
       &lt;xsl:text&gt;, scale=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@scale&quot;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/@count_scale&quot;&gt;
       &lt;xsl:text&gt;, count_scale=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@count_scale&quot;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/@type_graf&quot;&gt;
       &lt;xsl:text&gt;, type_graf=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@type_graf&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/@tzn_frame&quot;&gt;
       &lt;xsl:text&gt;, tzn_frame=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@tzn_frame&quot;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/@name&quot;&gt;
       &lt;xsl:text&gt;, name=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@name&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;./img/@name_style&quot;&gt;
       &lt;xsl:text&gt;, name_style=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@name_style&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;

    &lt;xsl:call-template name=&quot;gen-colors&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;./img&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:call-template name=&quot;gen-series&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;!-- hist  --&gt;
&lt;xsl:template match=&quot;hist&quot;&gt;
    &lt;xsl:variable name=&quot;img&quot; select=&quot;./img&quot;/&gt;
    &lt;xsl:text&gt;  h.hist(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;

    &lt;xsl:choose&gt;
    &lt;xsl:when test=&quot;./img[@dir=&#x27;V&#x27; or @dir=&#x27;N&#x27;]&quot;&gt;
        &lt;xsl:text&gt;), thickness=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
        &lt;xsl:text&gt;, length=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:otherwise&gt;
        &lt;xsl:text&gt;), thickness=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
        &lt;xsl:text&gt;, length=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
    &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
    &lt;xsl:text&gt;, v_range=(&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_n&quot;/&gt;
    &lt;xsl:text&gt;&#x27;, &#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_v&quot;/&gt;
    &lt;xsl:text&gt;&#x27;), direction=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@dir&quot;/&gt;
    &lt;xsl:text&gt;&#x27;, kind=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@type&quot;/&gt;
    &lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;
    &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:if test=&quot;$img/@filltype&quot;&gt;
        &lt;xsl:text&gt;, filltype=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@filltype&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;$img/@name&quot;&gt;
        &lt;xsl:text&gt;, name=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@name&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;$img/@double&quot;&gt;
        &lt;xsl:text&gt;, double_attr=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@double&quot;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:apply-templates select=&quot;$img/colors&quot;/&gt;
    &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;!-- timerk --&gt;

&lt;xsl:template match=&quot;timerk&quot;&gt;
    &lt;xsl:variable name=&quot;img&quot; select=&quot;./img&quot;/&gt;
    &lt;xsl:text&gt;  h.timerk(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
    &lt;xsl:text&gt;), w=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
    &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
    &lt;xsl:text&gt;, v_range=(&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_n&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_v&quot;/&gt;
    &lt;xsl:text&gt;), wct=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@wct&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;
    &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:if test=&quot;$img/@name&quot;&gt;
        &lt;xsl:text&gt;, name=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@name&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;.//text/@txt&quot;&gt;
        &lt;xsl:text&gt;, label=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.//text/@txt&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;.//text/@fontid&quot;&gt;
        &lt;xsl:text&gt;, fontid=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.//text/@fontid&quot;/&gt;&lt;xsl:text&gt;&quot;,&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:apply-templates select=&quot;./img/colors&quot;/&gt;

    &lt;!--&lt;xsl:call-template name=&quot;gen-style&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;$img&quot;/&gt;&lt;/xsl:call-template&gt;--&gt;
    &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;!-- par_graf --&gt;

&lt;xsl:template match=&quot;par_graf&quot;&gt;
    &lt;xsl:variable name=&quot;img&quot; select=&quot;./img&quot;/&gt;
    &lt;xsl:variable name=&quot;graph&quot;&gt;
    &lt;xsl:text&gt;  h.par_graf(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
    &lt;xsl:text&gt;), w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
    &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
    &lt;xsl:text&gt;, x_range=(&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_n_x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_v_x&quot;/&gt;
    &lt;xsl:text&gt;), napr_x=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@napr_x&quot;/&gt;
    &lt;xsl:text&gt;&quot;, y_range=(&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_n_y&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@pred_v_y&quot;/&gt;
    &lt;xsl:text&gt;), napr_y=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$img/@napr_y&quot;/&gt;
    &lt;xsl:text&gt;&quot;, &lt;/xsl:text&gt;
    &lt;/xsl:variable&gt;

    &lt;xsl:for-each select=&quot;.//obj_par_graf&quot;&gt;
        &lt;xsl:value-of select=&quot;$graph&quot;/&gt;
        &lt;xsl:text&gt; xbind=pg.tag((&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$bindPrefix&quot;/&gt;:&lt;xsl:value-of select=&quot;./param/@mas_x&quot;/&gt;
        &lt;xsl:text&gt;&#x27;, &#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./param/@nom_x&quot;/&gt;
        &lt;xsl:text&gt;&#x27;, &quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./param/@iden_x&quot;/&gt;
        &lt;xsl:text&gt;&quot;)), ybind=pg.tag((&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$bindPrefix&quot;/&gt;:&lt;xsl:value-of select=&quot;./param/@mas_y&quot;/&gt;
        &lt;xsl:text&gt;&#x27;, &#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./param/@nom_y&quot;/&gt;
        &lt;xsl:text&gt;&#x27;, &quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./param/@iden_y&quot;/&gt;
        &lt;xsl:text&gt;&quot;)), marker=#h.graph_marker_&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@icon&quot;/&gt;&lt;xsl:text&gt;(&lt;/xsl:text&gt;
        &lt;xsl:text&gt;size=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@size&quot;/&gt;
        &lt;xsl:text&gt;, color=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@color&quot;/&gt;
    &lt;xsl:text&gt;&#x27;));
&lt;/xsl:text&gt;
    &lt;/xsl:for-each&gt;
&lt;/xsl:template&gt;

&lt;!-- bpk --&gt;
&lt;xsl:template match=&quot;bpk&quot;&gt;
    &lt;xsl:text&gt;  h.bpk(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
       &lt;xsl:text&gt;), w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
       &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
        &lt;xsl:text&gt;, bind=pg.tag(&lt;/xsl:text&gt;
        &lt;xsl:apply-templates select=&quot;.//param[@type=&#x27;bpk&#x27;]&quot;/&gt;
        &lt;xsl:text&gt;)&lt;/xsl:text&gt;
        &lt;xsl:apply-templates select=&quot;./img/colors&quot;/&gt;
        &lt;xsl:if test=&quot;.//param[@goto]&quot;&gt;
            &lt;xsl:text&gt;, menu=(&lt;/xsl:text&gt;
                  &lt;xsl:for-each select=&quot;.//param[@goto]&quot;&gt;
                    &lt;xsl:text&gt;(href=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./@goto&quot;/&gt;
                    &lt;xsl:text&gt;&quot;, bind=pg.tag(&lt;/xsl:text&gt;
                      &lt;xsl:apply-templates select=&quot;.&quot;/&gt;
                    &lt;xsl:text&gt;))&lt;/xsl:text&gt;
                    &lt;xsl:if test=&quot;position() != last()&quot;&gt;
                      &lt;xsl:text&gt;, &lt;/xsl:text&gt;
                    &lt;/xsl:if&gt;
                  &lt;/xsl:for-each&gt;
            &lt;xsl:text&gt;)&lt;/xsl:text&gt;
      &lt;/xsl:if&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;

&lt;/xsl:template&gt;


&lt;!-- dtablo --&gt;
&lt;xsl:template match=&quot;dtablo&quot;&gt;
   &lt;xsl:variable name=&quot;X&quot; select=&quot;@x&quot;/&gt;
   &lt;xsl:variable name=&quot;Y&quot; select=&quot;@y&quot;/&gt;
   &lt;xsl:variable name=&quot;H&quot; select=&quot;@h&quot;/&gt;

    &lt;xsl:text&gt;  h.dtablo(
    p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
       &lt;xsl:text&gt;), w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
       &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
       &lt;xsl:text&gt;, algor=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./params/@algor&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
       &lt;xsl:text&gt;, framewidth=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@framewidth&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
       &lt;xsl:text&gt;, din=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@din&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
       &lt;xsl:text&gt;, name=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@name&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
       &lt;xsl:text&gt;, color_style=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@color_style&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
       &lt;xsl:text&gt;, zkv=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@zkv&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
       &lt;xsl:text&gt;, colors=(contour=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@contour&quot;/&gt;&lt;xsl:text&gt;&#x27;)&lt;/xsl:text&gt;
       &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:apply-templates select=&quot;./img/@fontid&quot; mode=&quot;style&quot;/&gt;&lt;xsl:text&gt;
    &lt;/xsl:text&gt;
       &lt;xsl:call-template name=&quot;gen-sost&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
       &lt;xsl:text&gt;,
   &lt;/xsl:text&gt;
       &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
       &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;!-- tablo --&gt;
&lt;xsl:template match=&quot;tablo[./img/@shape]&quot;&gt;
   &lt;xsl:variable name=&quot;X&quot; select=&quot;@x&quot;/&gt;
   &lt;xsl:variable name=&quot;Y&quot; select=&quot;@y&quot;/&gt;
   &lt;xsl:variable name=&quot;H&quot; select=&quot;@h&quot;/&gt;
   &lt;xsl:text&gt;  h.tablo(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$X&quot;/&gt;&lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$Y&quot;/&gt;&lt;xsl:text&gt;)&lt;/xsl:text&gt;
   &lt;xsl:text&gt;, w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
   &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$H&quot;/&gt;
   &lt;xsl:text&gt;, &lt;/xsl:text&gt;
   &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
   &lt;xsl:text&gt;, algor=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./params/@algor&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
   &lt;xsl:text&gt;, shape=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@shape&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
   &lt;xsl:text&gt;, txt=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;str:replace(str:replace(./img/text/@txt, &#x27;\&#x27;, &#x27;\\&#x27;), &#x27;&amp;quot;&#x27;, &#x27;\&amp;quot;&#x27;)&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
   &lt;xsl:text&gt;, name=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@name&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
   &lt;xsl:text&gt;, din=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@din&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
   &lt;xsl:text&gt;, font=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/text/@fontid&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
   &lt;xsl:text&gt;, blink=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@blink&quot;/&gt;
   &lt;xsl:apply-templates select=&quot;./img/colors&quot;/&gt;
   &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
   &lt;xsl:text&gt;);&amp;#xa;&lt;/xsl:text&gt;
  &lt;!--&lt;xsl:choose&gt;--&gt;
    &lt;!--&lt;xsl:when test=&quot;./img/text&quot;&gt;--&gt;
    &lt;!--&lt;xsl:variable name=&quot;TX&quot;&gt;--&gt;
        &lt;!--&lt;xsl:choose&gt;--&gt;
        &lt;!--&lt;xsl:when test=&quot;./img/text/@x&quot;&gt;&lt;xsl:value-of select=&quot;./img/text/@x&quot;/&gt;--&gt;
        &lt;!--&lt;/xsl:when&gt;--&gt;
        &lt;!--&lt;xsl:otherwise&gt;&lt;xsl:text&gt;0&lt;/xsl:text&gt;--&gt;
        &lt;!--&lt;/xsl:otherwise&gt;--&gt;
        &lt;!--&lt;/xsl:choose&gt;--&gt;
    &lt;!--&lt;/xsl:variable&gt;--&gt;
   &lt;!--&lt;xsl:text&gt;{--&gt;
   &lt;!--&lt;/xsl:text&gt;--&gt;
       &lt;!--&lt;xsl:text&gt;  text(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number($X)+number($TX)&quot;/&gt;--&gt;
           &lt;!--&lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number($Y) + 0.5*(number($H) + number(./img/text/@y))&quot;/&gt;--&gt;
           &lt;!--&lt;xsl:text&gt;, &quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;str:replace(./img/text/@txt, &#x27;&amp;quot;&#x27;, &#x27;\&amp;quot;&#x27;)&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;--&gt;
           &lt;!--&lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;./img/text&quot;/&gt;&lt;xsl:with-param name=&quot;func&quot;&gt;text_styling&lt;/xsl:with-param&gt;&lt;/xsl:call-template&gt;--&gt;
           &lt;!--&lt;xsl:text&gt;);--&gt;
  &lt;!--&lt;/xsl:text&gt;--&gt;
  &lt;!--&lt;xsl:text&gt;}  // rect_tablo--&gt;
&lt;!--&lt;/xsl:text&gt;--&gt;
    &lt;!--&lt;/xsl:when&gt;--&gt;
    &lt;!--&lt;xsl:otherwise&gt;&lt;xsl:text&gt;;--&gt;
&lt;!--&lt;/xsl:text&gt;--&gt;
    &lt;!--&lt;/xsl:otherwise&gt;--&gt;
   &lt;!--&lt;/xsl:choose&gt;--&gt;
&lt;/xsl:template&gt;

&lt;!-- rdp --&gt;
&lt;xsl:template match=&quot;rdp&quot;&gt;
    &lt;xsl:text&gt;  h.rdp(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
    &lt;xsl:text&gt;), w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
    &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
    &lt;xsl:text&gt;, wk=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@wk&quot;/&gt;
    &lt;xsl:text&gt;, hk=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@hk&quot;/&gt;
    &lt;xsl:text&gt;, name=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@name&quot;/&gt;
    &lt;xsl:text&gt;&#x27;, algor=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./params/@algor&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;
    &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;!-- clock --&gt;
&lt;xsl:template match=&quot;clock&quot;&gt;
   &lt;xsl:text&gt;  h.clock(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
   &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
   &lt;xsl:text&gt;), w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
   &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
   &lt;xsl:apply-templates select=&quot;./img/colors&quot;/&gt;
   &lt;xsl:text&gt;, &lt;/xsl:text&gt;
   &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
   &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;!-- block_diagr --&gt;

&lt;xsl:template match=&quot;block_diagr&quot;&gt;
   &lt;xsl:text&gt;  h.block_diagr(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
   &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
   &lt;xsl:text&gt;), w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
   &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
   &lt;xsl:text&gt;, name=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@name&quot;/&gt;
   &lt;xsl:text&gt;&quot;, figure=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@polygon&quot;/&gt;
   &lt;xsl:text&gt;&quot;, num_diagr=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@num_diagr&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
   &lt;xsl:if test=&quot;./params/@algor&quot;&gt;
     &lt;xsl:text&gt;, algor=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./params/@algor&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
   &lt;/xsl:if&gt;
   &lt;xsl:text&gt;, &lt;/xsl:text&gt;
   &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
   &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;!-- knop_diagr --&gt;
&lt;xsl:template match=&quot;knop_diagr&quot;&gt;
    &lt;xsl:text&gt;  h.knop_diagr(
    &lt;/xsl:text&gt;
    &lt;xsl:text&gt;p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;&lt;xsl:text&gt;)&lt;/xsl:text&gt;
    &lt;xsl:text&gt;, w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
    &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
    &lt;xsl:text&gt;, name=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@name&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;, color_style=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@color_style&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;, num_diagr=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@num_diagr&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;, din=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./img/@din&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;,
    &lt;/xsl:text&gt;
    &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;,
    &lt;/xsl:text&gt;
    &lt;xsl:call-template name=&quot;gen-sost&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;
  &lt;/xsl:text&gt;
&lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;!-- zont --&gt;
&lt;xsl:template match=&quot;zont&quot;&gt;
  &lt;xsl:variable name=&quot;params&quot; select=&quot;.//param&quot;/&gt;
  &lt;xsl:text&gt;  h.zont(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
  &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
  &lt;xsl:text&gt;), w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
  &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
  &lt;xsl:apply-templates select=&quot;./img/colors&quot;/&gt;
  &lt;xsl:text&gt;, binds=pg.tag(&lt;/xsl:text&gt;
        &lt;xsl:for-each select=&quot;$params&quot;&gt;
          &lt;xsl:apply-templates select=&quot;.&quot;/&gt;
          &lt;xsl:if test=&quot;position() != last()&quot;&gt;
            &lt;xsl:text&gt;, &lt;/xsl:text&gt;
          &lt;/xsl:if&gt;
        &lt;/xsl:for-each&gt;
  &lt;xsl:text&gt;)&lt;/xsl:text&gt;
  &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
  &lt;xsl:text&gt;);&amp;#xa;&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;!-- kfb --&gt;

&lt;xsl:template match=&quot;kfb&quot;&gt;
  &lt;xsl:variable name=&quot;params&quot; select=&quot;.//param&quot;/&gt;
    &lt;xsl:text&gt;  h.kfb(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
       &lt;xsl:text&gt;), w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
       &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
       &lt;xsl:text&gt;, bind=pg.tag(&lt;/xsl:text&gt;
          &lt;xsl:for-each select=&quot;$params&quot;&gt;
            &lt;xsl:apply-templates select=&quot;.&quot;/&gt;
            &lt;xsl:if test=&quot;position() != last()&quot;&gt;
              &lt;xsl:text&gt;, &lt;/xsl:text&gt;
            &lt;/xsl:if&gt;
          &lt;/xsl:for-each&gt;
       &lt;xsl:text&gt;), sost=(&lt;/xsl:text&gt;
          &lt;xsl:for-each select=&quot;./img/sost&quot;&gt;
            &lt;xsl:text&gt;(nom=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./@nom&quot;/&gt;
            &lt;xsl:text&gt;, file=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./@file&quot;/&gt;
            &lt;xsl:text&gt;&quot;)&lt;/xsl:text&gt;
            &lt;xsl:if test=&quot;position() != last()&quot;&gt;
              &lt;xsl:text&gt;, &lt;/xsl:text&gt;
            &lt;/xsl:if&gt;
          &lt;/xsl:for-each&gt;
    &lt;xsl:text&gt;));
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;knop&quot;&gt;
  &lt;xsl:variable name=&quot;label&quot;&gt;
    &lt;xsl:choose&gt;
     &lt;xsl:when test=&quot;.//text[@txt]&quot;&gt;&lt;xsl:value-of select=&quot;.//text/@txt&quot;/&gt;&lt;/xsl:when&gt;
     &lt;xsl:otherwise&gt;&lt;xsl:value-of select=&quot;.//param/@iden&quot;/&gt;&lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:variable&gt;

    &lt;xsl:text&gt;  h.knopka(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
       &lt;xsl:text&gt;), w=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
       &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
    &lt;xsl:text&gt;, label=&quot;&lt;/xsl:text&gt;
    &lt;xsl:choose&gt;
     &lt;xsl:when test=&quot;.//text[@txt]&quot;&gt;&lt;xsl:value-of select=&quot;.//text/@txt&quot;/&gt;&lt;/xsl:when&gt;
     &lt;xsl:otherwise&gt;&lt;xsl:value-of select=&quot;.//param/@iden&quot;/&gt;&lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
    &lt;xsl:text&gt;&quot;, ref=pg.mnemoref(&#x27;&lt;/xsl:text&gt;
    &lt;xsl:value-of select=&quot;$bindPrefix&quot;/&gt;:&lt;xsl:value-of select=&quot;.//param/@iden&quot;/&gt;
    &lt;xsl:text&gt;&#x27;)&lt;/xsl:text&gt;

    &lt;xsl:apply-templates select=&quot;./img/colors&quot;/&gt;
    &lt;xsl:if test=&quot;./params/@algor&quot;&gt;
        &lt;xsl:text&gt;, algor=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./params/@algor&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;number(.//param/@nom) &amp;gt; 0&quot;&gt;
      &lt;xsl:text&gt;, &lt;/xsl:text&gt;
      &lt;xsl:call-template name=&quot;gen-bind&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;.//text/@fontid&quot;&gt;
        &lt;xsl:text&gt;, fontid=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.//text/@fontid&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:text&gt;, styler=styler&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;nastr&quot;&gt;
    &lt;xsl:for-each select=&quot;./@*&quot;&gt;
        &lt;xsl:value-of select=&quot;local-name(.)&quot;/&gt;
        &lt;xsl:text&gt;=&quot;&lt;/xsl:text&gt;
        &lt;xsl:value-of select=&quot;.&quot;/&gt;
        &lt;xsl:text&gt;&quot;,&lt;/xsl:text&gt;
    &lt;/xsl:for-each&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;kart&quot;&gt;
  &lt;xsl:variable name=&quot;params&quot; select=&quot;./params/param&quot;/&gt;
    &lt;xsl:text&gt;  h.kart(p=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
       &lt;xsl:text&gt;), w=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
       &lt;xsl:text&gt;, h=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
       &lt;xsl:apply-templates select=&quot;./img/colors&quot;/&gt;
       &lt;xsl:text&gt;, binds=(&lt;/xsl:text&gt;
          &lt;xsl:for-each select=&quot;$params&quot;&gt;
            &lt;xsl:text&gt;
     (&lt;/xsl:text&gt;
            &lt;xsl:apply-templates select=&quot;./nastr&quot;/&gt;
            &lt;xsl:text&gt; bind1=pg.tag(&lt;/xsl:text&gt;&lt;xsl:apply-templates select=&quot;.&quot;/&gt;
            &lt;xsl:text&gt;), bind2=pg.tag(&lt;/xsl:text&gt;&lt;xsl:apply-templates select=&quot;./param&quot;/&gt;
            &lt;xsl:text&gt;))&lt;/xsl:text&gt;
            &lt;xsl:if test=&quot;position() != last()&quot;&gt;
              &lt;xsl:text&gt;,&lt;/xsl:text&gt;
            &lt;/xsl:if&gt;
          &lt;/xsl:for-each&gt;
    &lt;xsl:text&gt;));
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;*&quot;&gt;
    &lt;xsl:text&gt;  h.unknown_tag(Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@x&quot;/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@y&quot;/&gt;
    &lt;xsl:if test=&quot;@w&quot;&gt;
       &lt;xsl:text&gt;), aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@w&quot;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;@h&quot;&gt;
       &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@h&quot;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:text&gt;, tag=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;local-name(.)&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;xsl:if test=&quot;@name&quot;&gt;
        &lt;xsl:text&gt;, name=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@name&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;!-- styling --&gt;
&lt;xsl:template name=&quot;style-attributes&quot;&gt;
  &lt;xsl:param name=&quot;elem&quot;/&gt;
  &lt;xsl:param name=&quot;func&quot;&gt;styling&lt;/xsl:param&gt;

   &lt;xsl:text&gt;, attributes=styler.&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$func&quot;/&gt;&lt;xsl:text&gt;(&lt;/xsl:text&gt;
   &lt;xsl:choose&gt;
      &lt;xsl:when test=&quot;$elem/@bs and $elem/@bs != &#x27;solid&#x27;&quot;&gt;
          &lt;xsl:text&gt;fill=#h.pattern_&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$elem/@bs&quot;/&gt;
          &lt;xsl:text&gt;(&#x27;&lt;/xsl:text&gt;
          &lt;xsl:value-of select=&quot;$elem/@pc&quot;/&gt;
          &lt;xsl:text&gt;&#x27;, styler=styler),&lt;/xsl:text&gt;
          &lt;xsl:apply-templates select=&quot;$elem/@ps|$elem/@pw|$elem/@pc&quot; mode=&quot;style&quot;/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:when test=&quot;not($elem/@bs)&quot;&gt;
          &lt;xsl:apply-templates select=&quot;$elem/descendant-or-self::node()/@*[local-name( ) != &#x27;bc&#x27;]&quot; mode=&quot;style&quot;/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:apply-templates select=&quot;$elem/descendant-or-self::node()/@*&quot; mode=&quot;style&quot;/&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;xsl:text&gt;_dummy=0)&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template name=&quot;gen-style&quot;&gt;
  &lt;xsl:param name=&quot;elem&quot;/&gt;
  &lt;xsl:text&gt;, styleprops=(&lt;/xsl:text&gt;
    &lt;xsl:apply-templates select=&quot;$elem/descendant-or-self::node()/@*&quot; mode=&quot;style&quot;/&gt;
  &lt;xsl:text&gt;)&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@*&quot; /&gt;
&lt;xsl:template match=&quot;@*&quot; mode=&quot;style&quot;/&gt;

&lt;xsl:template match=&quot;@pc&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;pc=&lt;/xsl:text&gt;
  &lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
  &lt;xsl:text&gt;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@bc&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;bc=&lt;/xsl:text&gt;
  &lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
  &lt;xsl:text&gt;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@contour&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;contour=&lt;/xsl:text&gt;
  &lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
  &lt;xsl:text&gt;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@fill&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;fill=&lt;/xsl:text&gt;
  &lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
  &lt;xsl:text&gt;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@colorid&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;color=&lt;/xsl:text&gt;
  &lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
  &lt;xsl:text&gt;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@color&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;style_color=&lt;/xsl:text&gt;
  &lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
  &lt;xsl:text&gt;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@ps[not(contains(.,&#x27;solid&#x27;))]&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;ps=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;&#x27;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@pw[not(contains(.,&#x27;big_dots&#x27;))]&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;pw=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@fontid&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;font=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;&#x27;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;



&lt;xsl:template name=&quot;gen-sost&quot;&gt;
  &lt;xsl:param name=&quot;elem&quot;/&gt;
  &lt;xsl:variable name=&quot;sost&quot; select=&quot;$elem//sost&quot;/&gt;
  &lt;xsl:if test=&quot;$sost&quot;&gt;
    &lt;xsl:text&gt;sost=(
           &lt;/xsl:text&gt;
       &lt;xsl:for-each select=&quot;$sost&quot;&gt;
         &lt;xsl:text&gt;(txt=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./@txt&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
         &lt;xsl:text&gt;, ctxt=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./@ctxt&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
         &lt;xsl:text&gt;, color=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./@color&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
         &lt;xsl:if test=&quot;./@merc&quot;&gt;
            &lt;xsl:text&gt;, merc=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./@merc&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
         &lt;/xsl:if&gt;
         &lt;xsl:if test=&quot;./@num&quot;&gt;
            &lt;xsl:text&gt;, num=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;./@num&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
         &lt;/xsl:if&gt;
         &lt;xsl:text&gt;)&lt;/xsl:text&gt;
         &lt;xsl:if test=&quot;position() != last()&quot;&gt;
           &lt;xsl:text&gt;,
           &lt;/xsl:text&gt;
         &lt;/xsl:if&gt;
       &lt;/xsl:for-each&gt;
       &lt;xsl:text&gt;)&lt;/xsl:text&gt;
  &lt;/xsl:if&gt;
&lt;/xsl:template&gt;


&lt;/xsl:stylesheet&gt;</pre>
</body>
</html>
