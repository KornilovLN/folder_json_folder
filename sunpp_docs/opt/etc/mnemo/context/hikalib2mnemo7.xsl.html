
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>hikalib2mnemo7.xsl</title>
    <!--
    <style>
        body { font-family: Arial, sans-serif; }
        pre { background-color: #f0f0f0; padding: 10px; white-space: pre-wrap; word-wrap: break-word; }
    </style>
    -->
    <style>
        body { 
            font-family: Arial, sans-serif; 
        }
        pre { 
            background-color: #f0f0f0; 
            padding: 10px; 
            white-space: pre-wrap; 
            word-wrap: break-word;
            font-size: 14px;  /* Увеличенный размер шрифта */
            line-height: 1.5; /* Улучшенная читаемость */
        }
    </style>
</head>
<body>
    <h1>hikalib2mnemo7.xsl</h1>
    <pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
  xmlns:str=&quot;http://exslt.org/strings&quot;
  xmlns:math=&quot;http://exslt.org/math&quot;
  extension-element-prefixes=&quot;str math&quot;
  &gt;
&lt;xsl:import href=&quot;hika2mnemo7.xsl&quot;/&gt;
&lt;xsl:output method=&quot;text&quot; omit-xml-declaration=&quot;yes&quot; indent=&quot;no&quot; encoding=&quot;UTF-8&quot;/&gt;
&lt;!--&lt;xsl:strip-space elements=&quot;*&quot; /&gt;--&gt;


&lt;xsl:template match=&quot;/&quot;&gt;

    &lt;xsl:text&gt;/* This file is automatically generated. Do not make changes. */

def _mirror(p, mirror_flag){
  if(mirror_flag == &#x27;G&#x27;){
     translate(
         scale(translate(@, (-p.x, -p.y)),
         (-1.0, 1.0)
     ), p);
  }else{
    @;
  }
}

def _rotate(p, angle){
  if(angle){
     rotate(@, angle, p);
  }else{
    @;
  }
}

def _trafo(p, mirror_flag, conner) {
    _rotate(p, conner) {
        _mirror(p, mirror_flag) {
            @
        }
    }
}

def _wide(oldsize, newsize){
  if(oldsize != newsize){
    scale(@, newsize/oldsize);
  }else{
    @;
  }
}

def algorBind(p, bind, name, algor, attrs=None){
    bindtype := &#x27;algor_{}&#x27;.format(algor);
    a(p, bindtype=bindtype, href=bind.href, attributes=attrs, bind=bind.bind_idx, class=&#x27;ppt&#x27;, block_name=name)
    { @; }
}


&lt;/xsl:text&gt;
    &lt;xsl:for-each select=&quot;files/file&quot;&gt;
        &lt;xsl:apply-templates select=&quot;document(@name)/block&quot; /&gt;
    &lt;/xsl:for-each&gt;
&lt;/xsl:template&gt;



&lt;xsl:template match=&quot;block[@kolsost=&#x27;1&#x27;]&quot;&gt;
    &lt;xsl:text&gt;@title(&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@tname)&quot;/&gt;&lt;xsl:text&gt;&#x27;)&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;@size((&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@width)&quot;/&gt;, &lt;xsl:value-of select=&quot;number(@height)&quot;/&gt;&lt;xsl:text&gt;))&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;def &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@name)&quot;/&gt;&lt;xsl:text&gt;(p=Origin, mirror=None, conner=None, styler=None){&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;  aspect ?= 1;&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;  center := Point(&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@width) div 2&quot;/&gt;&lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@height) div 2&quot;/&gt;)&lt;xsl:text&gt;;&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;  group(p){&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;    _trafo(center, mirror, conner) {&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:apply-templates select=&quot;sost/kvg&quot;/&gt;
    &lt;xsl:text&gt;    }&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;  }&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;}  // End of block&amp;#xa;&amp;#xa;&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;block&quot;&gt;
    &lt;xsl:text&gt;@title(&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@tname)&quot;/&gt;&lt;xsl:text&gt;&#x27;)&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;@size((&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@width)&quot;/&gt;, &lt;xsl:value-of select=&quot;number(@height)&quot;/&gt;&lt;xsl:text&gt;))&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;def &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@name)&quot;/&gt;&lt;xsl:text&gt;(p, w, h, bind, algor=None, styler=None){&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;  aspect ?= 1;&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;  algor := algor or &quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@tip_obj)&quot;/&gt;&lt;xsl:text&gt;&quot;;&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;  bind := bind.datakind_by_algor(algor);&amp;#xa;&lt;/xsl:text&gt;

    &lt;xsl:text&gt;  algorBind(p, bind, name=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@name)&quot;/&gt;&lt;xsl:text&gt;&quot;, algor=algor){&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;    _wide(&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;number(@width)&quot;/&gt;&lt;xsl:text&gt;, w){&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;      rect(topleft=Point(0, 0), width=aspect*w, height=h, class=&quot;blockbg&quot;);&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:apply-templates select=&quot;sost&quot;/&gt;
    &lt;xsl:text&gt;    }&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;  }&amp;#xa;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;}  // End of block&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;(@tname)&quot;/&gt;&lt;xsl:text&gt;&amp;#xa;&amp;#xa;&lt;/xsl:text&gt;
&lt;/xsl:template&gt;


&lt;xsl:template match=&quot;sost&quot;&gt;
&lt;xsl:if test=&quot;count(kvg/*)&quot;&gt;
    &lt;xsl:text&gt;  group(class=&quot;sost&lt;/xsl:text&gt;
    &lt;xsl:if test=&quot;@merc=&#x27;2&#x27;&quot;&gt;&lt;xsl:text&gt; blink&lt;/xsl:text&gt;&lt;/xsl:if&gt;
    &lt;xsl:text&gt;&quot;, num=&quot;&lt;/xsl:text&gt;
    &lt;xsl:value-of select=&quot;(@nom)&quot;/&gt;&lt;xsl:text&gt;&quot;){&amp;#xa;&lt;/xsl:text&gt;
&lt;xsl:apply-templates select=&quot;kvg[1]&quot;/&gt;
&lt;xsl:text&gt;  }&amp;#xa;&lt;/xsl:text&gt;
&lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;kvg&quot;&gt;
&lt;xsl:text&gt;  &lt;/xsl:text&gt;&lt;xsl:apply-templates select=&quot;./*&quot;/&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;kvg/text&quot;&gt;
  &lt;!-- sample
       &lt;text x=&quot;8&quot; y=&quot;30&quot; pencol=&quot;gray45&quot; fontid=&quot;18&quot; penwid=&quot;1&quot; &gt;sample text&lt;/text&gt;
  --&gt;
  &lt;xsl:if test=&quot;text()&quot;&gt;
    &lt;xsl:variable name=&quot;x&quot; select=&quot;number(@x)&quot;/&gt;
    &lt;xsl:variable name=&quot;y&quot; select=&quot;number(@y)&quot;/&gt;
    &lt;xsl:variable name=&quot;font&quot; select=&quot;(@fontid)&quot;/&gt;
    &lt;xsl:variable name=&quot;color&quot; select=&quot;(@pencol)&quot;/&gt;
    &lt;xsl:variable name=&quot;text&quot; select=&quot;str:replace(text(), &#x27;&amp;quot;&#x27;, &#x27;\&amp;quot;&#x27;)&quot;/&gt;
    &lt;xsl:text&gt;  text(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$x&quot;/&gt;
      &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$y&quot;/&gt;
      &lt;xsl:text&gt;, &quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$text&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
      &lt;xsl:text&gt;, attributes=styler.text_styling(&lt;/xsl:text&gt;
        &lt;xsl:text&gt;color=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$color&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
        &lt;xsl:text&gt;, font=&quot;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$font&quot;/&gt;&lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
      &lt;xsl:text&gt;)&lt;/xsl:text&gt;
    &lt;xsl:text&gt;);&amp;#xa;&lt;/xsl:text&gt;
  &lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;kvg/arc&quot;&gt;
    &lt;xsl:variable name=&quot;rx&quot; select=&quot;number(@w|@width) div 2&quot;/&gt;
    &lt;xsl:variable name=&quot;ry&quot; select=&quot;number(@h|@height) div 2&quot;/&gt;
    &lt;xsl:variable name=&quot;cx&quot; select=&quot;number(@x) + $rx&quot;/&gt;
    &lt;xsl:variable name=&quot;cy&quot; select=&quot;number(@y) + $ry&quot;/&gt;
    &lt;xsl:variable name=&quot;a1&quot;&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test=&quot;@a&quot;&gt;-&lt;xsl:value-of select=&quot;@a div 16&quot;/&gt;&lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;0&lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:variable&gt;
    &lt;xsl:if test=&quot;@alen and $rx &amp;gt; 0 and $ry &amp;gt; 0&quot;&gt;&lt;xsl:if test=&quot;number(@alen) != 0&quot;&gt;
        &lt;xsl:variable name=&quot;a2&quot; select=&quot;number($a1)-number(@alen) div 16&quot;/&gt;
        &lt;xsl:text&gt;  &lt;/xsl:text&gt;
        &lt;xsl:if test=&quot;@type&quot;&gt;&lt;xsl:value-of select=&quot;@type&quot;/&gt;&lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;not(@type)&quot;&gt;&lt;xsl:text&gt;arc&lt;/xsl:text&gt;&lt;/xsl:if&gt;
        &lt;xsl:text&gt;(c=Point(aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$cx&quot;/&gt;
        &lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$cy&quot;/&gt;
        &lt;xsl:choose&gt;
          &lt;xsl:when test=&quot;number(@w)=number(@h)&quot;&gt;
            &lt;xsl:text&gt;), radius=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$rx&quot;/&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt;
            &lt;xsl:text&gt;), rx=aspect*&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$rx&quot;/&gt;
            &lt;xsl:text&gt;, ry=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$ry&quot;/&gt;
          &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;
         &lt;xsl:text&gt;, angles=(&lt;/xsl:text&gt;
         &lt;xsl:choose&gt;
            &lt;xsl:when test=&quot;number(@alen) &amp;gt; 0&quot;&gt;
                &lt;xsl:value-of select=&quot;$a2&quot;/&gt;&lt;xsl:text&gt;, &lt;/xsl:text&gt;
                &lt;xsl:value-of select=&quot;$a1&quot;/&gt;
            &lt;/xsl:when&gt;
            &lt;xsl:otherwise&gt;
                &lt;xsl:value-of select=&quot;$a1&quot;/&gt;&lt;xsl:text&gt;, &lt;/xsl:text&gt;
                &lt;xsl:value-of select=&quot;$a2&quot;/&gt;
            &lt;/xsl:otherwise&gt;
          &lt;/xsl:choose&gt;
        &lt;xsl:text&gt;)&lt;/xsl:text&gt;
        &lt;xsl:call-template name=&quot;style-attributes&quot;&gt;&lt;xsl:with-param name=&quot;elem&quot; select=&quot;.&quot;/&gt;&lt;/xsl:call-template&gt;
        &lt;xsl:text&gt;);
&lt;/xsl:text&gt;
   &lt;/xsl:if&gt;&lt;/xsl:if&gt;
&lt;/xsl:template&gt;


&lt;!-- styling --&gt;
&lt;xsl:template name=&quot;style-attributes&quot;&gt;
  &lt;xsl:param name=&quot;elem&quot;/&gt;
  &lt;xsl:param name=&quot;func&quot;&gt;styler.styling&lt;/xsl:param&gt;

   &lt;xsl:text&gt;, attributes=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$func&quot;/&gt;&lt;xsl:text&gt;(&lt;/xsl:text&gt;
   &lt;xsl:apply-templates select=&quot;$elem/descendant-or-self::node()/@*&quot; mode=&quot;style&quot;/&gt;&lt;xsl:text&gt;_dummy=0)&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@*&quot; /&gt;
&lt;xsl:template match=&quot;@*&quot; mode=&quot;style&quot;/&gt;

&lt;xsl:template match=&quot;@brush&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;bc=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
  &lt;xsl:text&gt;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@pencol&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;pc=&#x27;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;xsl:text&gt;&#x27;&lt;/xsl:text&gt;
  &lt;xsl:text&gt;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;@penwid&quot; mode=&quot;style&quot;&gt;
  &lt;xsl:text&gt;pw=&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;
  &lt;xsl:text&gt;, &lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;
&lt;!--
&lt;?xml version=&quot;1.0&quot; encoding=&quot;KOI8-R&quot;?&gt;
 &lt;block width=&quot;46&quot; kolsost=&quot;11&quot; height=&quot;48&quot; tname=&quot;title text&quot; tip_obj=&quot;M&quot; name=&quot;ABPPL_M&quot; &gt;
 &lt;sost nom=&quot;1&quot; merc=&quot;1&quot; &gt;
  &lt;kvg&gt;
   &lt;polygon points=&quot;18,3 42,3 30,22 &quot; brush=&quot;red&quot; pencol=&quot;gray45&quot; penwid=&quot;2&quot; /&gt;
   &lt;polygon points=&quot;18,45 42,45 30,23 &quot; brush=&quot;red&quot; pencol=&quot;gray45&quot; penwid=&quot;2&quot; /&gt;
   &lt;line pencol=&quot;gray45&quot; penwid=&quot;2&quot; y1=&quot;23&quot; y2=&quot;23&quot; x1=&quot;10&quot; x2=&quot;30&quot; /&gt;
   &lt;rect width=&quot;9&quot; x=&quot;3&quot; y=&quot;8&quot; brush=&quot;gray80&quot; height=&quot;15&quot; pencol=&quot;gray45&quot; penwid=&quot;1&quot; /&gt;
   &lt;rect width=&quot;9&quot; x=&quot;3&quot; y=&quot;23&quot; brush=&quot;gray55&quot; height=&quot;15&quot; pencol=&quot;gray45&quot; penwid=&quot;1&quot; /&gt;
  &lt;/kvg&gt;
 &lt;/sost&gt;
 &lt;sost nom=&quot;2&quot; merc=&quot;1&quot; &gt;
  &lt;kvg&gt;
   &lt;polygon points=&quot;18,3 42,3 30,22 &quot; brush=&quot;#00aa00&quot; pencol=&quot;gray45&quot; penwid=&quot;2&quot; /&gt;
   &lt;polygon points=&quot;18,45 42,45 30,23 &quot; brush=&quot;#00aa00&quot; pencol=&quot;gray45&quot; penwid=&quot;2&quot; /&gt;
   &lt;line pencol=&quot;gray45&quot; penwid=&quot;2&quot; y1=&quot;23&quot; y2=&quot;23&quot; x1=&quot;10&quot; x2=&quot;30&quot; /&gt;
   &lt;rect width=&quot;9&quot; x=&quot;3&quot; y=&quot;8&quot; brush=&quot;gray80&quot; height=&quot;15&quot; pencol=&quot;gray45&quot; penwid=&quot;1&quot; /&gt;
   &lt;rect width=&quot;9&quot; x=&quot;3&quot; y=&quot;23&quot; brush=&quot;gray55&quot; height=&quot;15&quot; pencol=&quot;gray45&quot; penwid=&quot;1&quot; /&gt;
  &lt;/kvg&gt;
 &lt;/sost&gt;
 &lt;sost nom=&quot;3&quot; merc=&quot;1&quot; &gt;
  &lt;kvg&gt;
   &lt;polygon points=&quot;18,3 42,3 30,22 &quot; brush=&quot;gray55&quot; pencol=&quot;gray45&quot; penwid=&quot;2&quot; /&gt;
   &lt;polygon points=&quot;18,45 42,45 30,23 &quot; brush=&quot;gray55&quot; pencol=&quot;gray45&quot; penwid=&quot;2&quot; /&gt;
   &lt;line pencol=&quot;gray45&quot; penwid=&quot;2&quot; y1=&quot;23&quot; y2=&quot;23&quot; x1=&quot;10&quot; x2=&quot;30&quot; /&gt;
   &lt;rect width=&quot;9&quot; x=&quot;3&quot; y=&quot;8&quot; brush=&quot;gray80&quot; height=&quot;15&quot; pencol=&quot;gray45&quot; penwid=&quot;1&quot; /&gt;
   &lt;rect width=&quot;9&quot; x=&quot;3&quot; y=&quot;23&quot; brush=&quot;gray55&quot; height=&quot;15&quot; pencol=&quot;gray45&quot; penwid=&quot;1&quot; /&gt;
  &lt;/kvg&gt;
 &lt;/sost&gt;
--&gt;


&lt;!--

--&gt;</pre>
</body>
</html>
